(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[988],{50477:()=>{},87205:(e,t,s)=>{Promise.resolve().then(s.bind(s,71269))},71269:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var a=s(39233),r=s(65843),l=s(95155),n=s(12115),i=s(35007),d=s(14085),o=s(9955),c=s(87364),u=s(86889),m=s(44857),h=s(38684),f=s(33473),x=s(45686),p=s(77568),v=s(98867),g=s(30814),j=s(76046),N=s(79995),b=s(7478),w=s.n(b),y=s(10670),S=s.n(y),C=s(38003);let _=e=>{let{value:t,className:s}=e;return(0,l.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 ".concat(s),children:(0,l.jsx)("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:"".concat(t,"%")}})})};var I=s(9133);function R(){let e=(0,I.VP)(),t=(0,j.useRouter)();(0,n.useEffect)(()=>{"unauthenticated"===e&&(g.o.error("Session expired. Please login again."),t.push("/admin"))},[e,t]);let[s,b]=(0,n.useState)([]),[y,R]=(0,n.useState)(""),[k,A]=(0,n.useState)(""),E=(0,n.useRef)(null),[$,z]=(0,n.useState)("500px"),[T,P]=(0,n.useState)(!1),[V,D]=(0,n.useState)(0),[Q,Z]=(0,n.useState)(!1),[B,G]=(0,n.useState)(!1),[H,L]=(0,n.useState)("idle"),q=()=>(s.length+1).toString().padStart(3,"0"),F=e=>{b(s.filter(t=>t.userId!==e)),b(s.filter(t=>t.userId!==e).map((e,t)=>(0,r._)((0,a._)({},e),{userId:(t+1).toString().padStart(3,"0")})))},O=(e,t,l)=>{b(s.map(s=>s.userId===e?(0,r._)((0,a._)({},s),{[t]:l}):s))},U=s.reduce((e,t)=>(e[t.section]=(e[t.section]||0)+1,e),{});(0,n.useEffect)(()=>{let e=()=>{let e=window.innerHeight;z("".concat(e-150-60,"px"))};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let W=e=>{try{return w().AES.encrypt(JSON.stringify(e),"pice-bulsu-ams").toString()}catch(e){return console.error("Error encrypting data:",e),""}},M=async()=>{if(P(!0),L("generating"),D(0),0===s.length){g.o.error("Please add at least one student"),P(!1),L("idle");return}let e=new(S());try{let t=new Map;for(let e of s)t.has(e.section)||t.set(e.section,[]),t.get(e.section).push(e);let a=0;for(let[e,s]of t)a+=s.length;let r=0,l="User ID,Name,Section,validator.consolidate\n";for(let e of s)l+="".concat(e.userId,",").concat(e.name,",").concat(e.section,",\n");for(let[s,n]of(e.file("ForConsolidation.csv",l),t)){let t=e.folder(s);for(let e of n){let s=W(e),l=await N.toDataURL(s,{errorCorrectionLevel:"H"}),n=document.createElement("canvas"),i=n.getContext("2d"),d=new Image;d.src=l,await new Promise(e=>{d.onload=e}),n.width=200,n.height=250,null==i||i.drawImage(d,0,0,200,200),i.font="14px sans-serif",i.fillStyle="black",i.textAlign="center";let o="".concat(e.userId," | ").concat(e.name).split(" "),c="",u=220;for(let e=0;e<o.length;e++){let t=c+o[e]+" ";i.measureText(t).width>200?(i.fillText(c,100,u),c=o[e]+" ",u+=16):c=t}i.fillText(c,100,u);let m=n.toDataURL("image/png").split(",")[1];t.file("".concat(e.userId,"-").concat(e.name,".png"),m,{base64:!0});let h=++r/a*100;D(h)}}let n=await e.generateAsync({type:"blob"});(0,C.saveAs)(n,"qr_codes.zip"),G(!0),L("complete"),g.o.success("QR Codes Generated Successfully")}catch(e){g.o.error("There was an error generating the QR codes")}finally{P(!1),D(0),setTimeout(()=>{G(!1),L("idle")},3e3)}};return(0,l.jsxs)("div",{className:"container mx-auto p-4 space-y-4 h-full overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("h1",{className:"text-2xl font-bold",children:"Generate QR Codes"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(d.$,{variant:"outline",size:"icon",onClick:()=>t.push("/admin/dashboard"),children:(0,l.jsx)(c.A,{className:"h-4 w-4"})}),(0,l.jsx)(d.$,{variant:"outline",size:"icon",onClick:()=>t.push("/onboarding/administrator"),children:(0,l.jsx)(u.A,{className:"h-4 w-4"})})]})]}),(0,l.jsx)("div",{className:"grid gap-6 h-full overflow-hidden",children:(0,l.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 h-full overflow-hidden",children:[(0,l.jsxs)(i.Zp,{className:"h-full flex flex-col",children:[(0,l.jsx)(i.aR,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)(i.ZB,{children:"Student Data"}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(d.$,{variant:"outline",onClick:()=>{let e=new Blob(["Name,Section,validator.piceamsqr\n"],{type:"text/csv;charset=utf-8"});(0,C.saveAs)(e,"student_data_template.csv"),g.o.success("Reminder: Strictly do not put anything under the third column.")},children:[(0,l.jsx)(m.A,{className:"h-4 w-4 mr-2"}),"Template"]}),(0,l.jsxs)(d.$,{variant:"outline",onClick:()=>{var e;return null===(e=E.current)||void 0===e?void 0:e.click()},children:[(0,l.jsx)(h.A,{className:"h-4 w-4 mr-2"}),"Import CSV"]}),(0,l.jsx)("input",{type:"file",accept:".csv",className:"hidden",ref:E,onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!s)return;let a=new FileReader;a.onload=e=>{try{var t;let s=(null===(t=e.target)||void 0===t?void 0:t.result).split("\n");if(s.length<=1){g.o.error("CSV file is empty or contains only the header");return}let a=s[0].split(",").map(e=>e.trim());if(a.length<3||"validator.piceamsqr"!==a[2]){g.o.error("Invalid CSV format. The third header should be 'validator.piceamsqr'");return}let r=[];s.forEach((e,t)=>{if(0===t)return;let[s,a]=e.split(",").map(e=>e.trim());s&&a&&r.push({userId:(r.length+1).toString().padStart(3,"0"),name:s,section:a})}),b(r),g.o.success("CSV imported successfully")}catch(e){console.error("CSV import error:",e),g.o.error("Error importing CSV. Please check the file format.")}},a.readAsText(s)}})]})]})}),(0,l.jsxs)(i.Wu,{className:"overflow-auto flex-1 flex flex-col",style:{maxHeight:$},children:[(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsx)(o.p,{placeholder:"Name",value:y,onChange:e=>R(e.target.value)}),(0,l.jsx)(o.p,{placeholder:"Section",value:k,onChange:e=>A(e.target.value)}),(0,l.jsx)(d.$,{onClick:()=>{if(!y||!k){g.o.error("Please fill in both name and section");return}b([...s,{userId:q(),name:y,section:k}]),R(""),A("")},children:(0,l.jsx)(f.A,{className:"h-4 w-4"})})]}),(0,l.jsx)("div",{className:"relative w-full overflow-auto flex-1",children:(0,l.jsxs)("table",{className:"w-full caption-bottom text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("th",{className:"h-12 px-4 text-left align-middle font-medium",children:"User ID"}),(0,l.jsx)("th",{className:"h-12 px-4 text-left align-middle font-medium",children:"Name"}),(0,l.jsx)("th",{className:"h-12 px-4 text-left align-middle font-medium",children:"Section"}),(0,l.jsx)("th",{className:"h-12 px-4 text-left align-middle font-medium",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:s.map(e=>(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"p-4",children:e.userId}),(0,l.jsx)("td",{className:"p-4",children:(0,l.jsx)(o.p,{value:e.name,onChange:t=>O(e.userId,"name",t.target.value)})}),(0,l.jsx)("td",{className:"p-4",children:(0,l.jsx)(o.p,{value:e.section,onChange:t=>O(e.userId,"section",t.target.value)})}),(0,l.jsx)("td",{className:"p-4",children:(0,l.jsx)(d.$,{variant:"ghost",size:"icon",onClick:()=>F(e.userId),children:(0,l.jsx)(x.A,{className:"h-4 w-4 text-red-500"})})})]},e.userId))})]})})]}),(0,l.jsx)("div",{className:"mt-auto p-4 border-t",children:(0,l.jsx)(d.$,{variant:"outline",onClick:()=>{b([])},disabled:0===s.length,className:"w-full",children:"Clear All"})})]}),(0,l.jsxs)(i.Zp,{className:"h-full flex flex-col",children:[(0,l.jsx)(i.aR,{children:(0,l.jsx)(i.ZB,{children:"Summary"})}),(0,l.jsx)(i.Wu,{className:"overflow-auto flex-1",style:{maxHeight:$},children:(0,l.jsx)("div",{className:"relative w-full overflow-auto",children:(0,l.jsxs)("table",{className:"w-full caption-bottom text-sm",children:[(0,l.jsx)("thead",{children:(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("th",{className:"h-12 px-4 text-left align-middle font-medium",children:"Section"}),(0,l.jsx)("th",{className:"h-12 px-4 text-left align-middle font-medium",children:"Count"})]})}),(0,l.jsxs)("tbody",{children:[Object.entries(U).map(e=>{let[t,s]=e;return(0,l.jsxs)("tr",{className:"border-b",children:[(0,l.jsx)("td",{className:"p-4",children:t}),(0,l.jsx)("td",{className:"p-4",children:s})]},t)}),(0,l.jsxs)("tr",{className:"font-medium",children:[(0,l.jsx)("td",{className:"p-4",children:"Total Students"}),(0,l.jsx)("td",{className:"p-4",children:s.length})]})]})]})})}),(0,l.jsx)("div",{className:"mt-auto p-4 border-t",children:"idle"===H?(0,l.jsx)("div",{className:"w-full",children:(0,l.jsxs)(d.$,{className:"w-full",disabled:0===s.length,onClick:M,children:[(0,l.jsx)(p.A,{className:"h-4 w-4 mr-2"})," Generate QR Codes"]})}):"generating"===H?(0,l.jsxs)("div",{className:"flex flex-col gap-2 w-full",children:[(0,l.jsx)(_,{value:V,className:"h-2 transition-all"}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[(0,l.jsx)("span",{children:"Generating QR Codes..."}),(0,l.jsxs)("span",{className:"tabular-nums",children:[Math.round(V),"%"]})]})]}):(0,l.jsx)("div",{className:"flex justify-center w-full",children:(0,l.jsx)(d.$,{className:"w-full bg-emerald-500 text-white hover:bg-emerald-500 active:bg-emerald-500 transition-colors duration-200",children:(0,l.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm font-medium text-white",children:[(0,l.jsx)(v.A,{className:"h-4 w-4 mr-2"}),(0,l.jsx)("span",{children:"Generation Complete!"})]})})})})]})]})})]})}},14085:(e,t,s)=>{"use strict";s.d(t,{$:()=>u,r:()=>c});var a=s(39233),r=s(94556),l=s(95155),n=s(12115),i=s(12317),d=s(31027),o=s(29602);let c=(0,d.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),u=n.forwardRef((e,t)=>{var{className:s,variant:n,size:d,asChild:u=!1}=e,m=(0,r._)(e,["className","variant","size","asChild"]);let h=u?i.DX:"button";return(0,l.jsx)(h,(0,a._)({className:(0,o.cn)(c({variant:n,size:d,className:s})),ref:t},m))});u.displayName="Button"},35007:(e,t,s)=>{"use strict";s.d(t,{Wu:()=>u,ZB:()=>c,Zp:()=>d,aR:()=>o});var a=s(39233),r=s(94556),l=s(95155),n=s(12115),i=s(29602);let d=n.forwardRef((e,t)=>{var{className:s}=e,n=(0,r._)(e,["className"]);return(0,l.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",s)},n))});d.displayName="Card";let o=n.forwardRef((e,t)=>{var{className:s}=e,n=(0,r._)(e,["className"]);return(0,l.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",s)},n))});o.displayName="CardHeader";let c=n.forwardRef((e,t)=>{var{className:s}=e,n=(0,r._)(e,["className"]);return(0,l.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("font-semibold leading-none tracking-tight",s)},n))});c.displayName="CardTitle",n.forwardRef((e,t)=>{var{className:s}=e,n=(0,r._)(e,["className"]);return(0,l.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s)},n))}).displayName="CardDescription";let u=n.forwardRef((e,t)=>{var{className:s}=e,n=(0,r._)(e,["className"]);return(0,l.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("p-6 pt-0",s)},n))});u.displayName="CardContent",n.forwardRef((e,t)=>{var{className:s}=e,n=(0,r._)(e,["className"]);return(0,l.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",s)},n))}).displayName="CardFooter"},9955:(e,t,s)=>{"use strict";s.d(t,{p:()=>d});var a=s(39233),r=s(94556),l=s(95155),n=s(12115),i=s(29602);let d=n.forwardRef((e,t)=>{var{className:s,type:n}=e,d=(0,r._)(e,["className","type"]);return(0,l.jsx)("input",(0,a._)({type:n,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t},d))});d.displayName="Input"},29602:(e,t,s)=>{"use strict";s.d(t,{cn:()=>l});var a=s(43463),r=s(69795);function l(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,r.QP)((0,a.$)(t))}},9133:(e,t,s)=>{"use strict";s.d(t,{VP:()=>r,ln:()=>l});var a=s(12115);function r(){let[e,t]=(0,a.useState)("pending");return(0,a.useEffect)(()=>{"admin"===sessionStorage.getItem("userRole")?t("authenticated"):t("unauthenticated")},[]),e}function l(){sessionStorage.removeItem("userRole"),sessionStorage.removeItem("userName")}}},e=>{var t=t=>e(e.s=t);e.O(0,[524,814,842,715,441,517,358],()=>t(87205)),_N_E=e.O()}]);