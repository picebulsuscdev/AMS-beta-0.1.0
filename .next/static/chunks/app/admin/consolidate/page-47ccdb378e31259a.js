(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[476],{55621:(e,t,s)=>{Promise.resolve().then(s.bind(s,99206))},99206:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>er});var a=s(39233),n=s(65843),r=s(95155),l=s(12115),i=s(76046),c=s(35007),o=s(14085),d=s(87364),m=s(86889),u=s(70001),x=s(28880),h=s(44857),f=s(88280),p=s(49688),j=s(40767),g=s(30814);let v=e=>{let{onFileSelected:t,file:s,title:i,onRemove:c,errorMessage:d}=e,[m,u]=(0,l.useState)(!1),x=(0,l.useCallback)(e=>{if(e.length>0){let s=e[0],a=new FileReader;a.onload=e=>{try{var a;let n=(null===(a=e.target)||void 0===a?void 0:a.result).split("\n");if(n.length<=1){g.o.error("CSV file is empty or contains only the header"),u(!0),setTimeout(()=>{u(!1)},500);return}let r=n[0].split(",").map(e=>e.trim());if(r.length<4||"validator.consolidate"!==r[3]){g.o.error("Invalid CSV format. Please ensure the consolidation file was generated by the system and never modified."),u(!0),setTimeout(()=>{u(!1)},1e3);return}t(s)}catch(e){console.error("Error validating CSV:",e),g.o.error("Error validating CSV."),u(!0),setTimeout(()=>{u(!1)},500)}},a.readAsText(s)}},[t]),h=(0,l.useCallback)(e=>{e.length>0&&(g.o.error(e[0].errors[0].message),u(!0),setTimeout(()=>{u(!1)},500))},[]),{getRootProps:v,getInputProps:N,isDragActive:y}=(0,f.VB)({onDrop:x,accept:{"text/csv":[".csv"]},maxFiles:1,disabled:!!s,onDropRejected:h});return(0,r.jsxs)("div",{children:[s?(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,r.jsx)("span",{className:"text-sm truncate",children:s.name}),(0,r.jsx)(o.$,{variant:"ghost",size:"icon",onClick:c,children:(0,r.jsx)(j.A,{className:"h-4 w-4"})})]}):(0,r.jsxs)("div",(0,n._)((0,a._)({},v()),{className:"border-2 border-dashed rounded-lg cursor-pointer transition-colors  p-4 flex items-center justify-center gap-4\n              ".concat(m?"border-red-500 bg-red-100":"hover:border-primary hover:bg-accent/50","\n               ").concat(m?"animate-shake":"","\n             "),style:{height:"100px",maxHeight:"70px",width:"100%"},children:[(0,r.jsx)("input",(0,a._)({},N())),(0,r.jsx)(p.A,{className:"h-10 w-10 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Drag and drop the consolidation file here, or click to select file"})]})),d&&(0,r.jsx)("p",{className:"text-red-500 text-sm mt-1",children:d})]})},N=e=>{let{onFilesSelected:t,files:s,title:i,onRemove:c}=e,[d,m]=(0,l.useState)(!1),u=(0,l.useCallback)(async e=>{let s=[];for(let t of e)try{let e=new FileReader,a=(await new Promise((s,a)=>{e.onload=e=>{var t;return s(null===(t=e.target)||void 0===t?void 0:t.result)},e.onerror=()=>a("Error reading file"),e.readAsText(t)})).split("\n");if(a.length<=1){g.o.error('CSV file "'.concat(t.name,'" is empty or contains only the header')),m(!0),setTimeout(()=>{m(!1)},500);continue}let n=a[0].split(",").map(e=>e.trim());if(n.length<7||"validator.piceamslogs"!==n[6]){g.o.error('Invalid CSV format in "'.concat(t.name,'". Please ensure the attendance log was generated by the system and never modified.')),m(!0),setTimeout(()=>{m(!1)},500);continue}s.push(t)}catch(e){console.error('Error validating CSV "'.concat(t.name,'":'),e),g.o.error('Error validating CSV "'.concat(t.name,'"')),m(!0),setTimeout(()=>{m(!1)},500)}s.length>0&&t(s)},[t]),x=(0,l.useCallback)(e=>{e.length>0&&(g.o.error("Invalid file type. Only CSV files are allowed."),m(!0),setTimeout(()=>{m(!1)},1e3))},[]),{getRootProps:h,getInputProps:v,isDragActive:N}=(0,f.VB)({onDrop:u,onDropRejected:x,accept:{"text/csv":[".csv"]}});return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",(0,n._)((0,a._)({},h()),{className:"border-2 border-dashed rounded-lg cursor-pointer transition-colors p-4 flex items-center justify-center gap-4\n                ".concat(d?"border-red-500 bg-red-100":"hover:border-primary hover:bg-accent/50","\n                ").concat(d?"animate-shake":"","\n                 "),style:{minHeight:"70px"},children:[(0,r.jsx)("input",(0,a._)({},v())),(0,r.jsx)(p.A,{className:"h-10 w-10 text-muted-foreground"}),(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Drag and drop Attendance Log here, or click to select files"})]})),(0,r.jsx)("div",{className:"space-y-2",children:s.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,r.jsx)("span",{className:"text-sm truncate",children:e.name}),(0,r.jsx)(o.$,{variant:"ghost",size:"icon",onClick:()=>{c(t)},children:(0,r.jsx)(j.A,{className:"h-4 w-4"})})]},t))})]})};var y=s(11316);let b=(0,l.forwardRef)((e,t)=>{let{consolidationFile:s,attendanceFiles:r,onConsolidated:i,setIsConsolidating:c,setIsParsing:o}=e,d=e=>{if(!e)return null;try{let[t,s]=e.split(" | ");if(!s)return null;let[a,n]=s.split(":").map(Number),r=new Date;r.setHours(a,n);let l=r.getHours()%12||12,i=r.getHours()>=12?"PM":"AM";return"".concat(l,":").concat(String(r.getMinutes()).padStart(2,"0")," ").concat(i)}catch(e){return null}},m=async e=>{try{return await e.text()}catch(t){throw console.error("Error reading file:",t),g.o.error("Error reading file: ".concat(e.name)),t}},u=(0,l.useCallback)(async()=>{if(c(!0),o(!0),g.o.loading("Starting consolidation..."),!s){g.o.error("No Consolidation File is selected."),c(!1),o(!1),g.o.dismiss();return}if(0===r.length){g.o.error("No Attendance Log is selected."),c(!1),o(!1),g.o.dismiss();return}try{let e=await m(s),t=(0,y.E3)(e,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim()});if(!(null==t?void 0:t.data)||0===t.data.length){g.o.error("Consolidation File could not be parsed."),console.error("CSV Parsing Error (Consolidation):",t),c(!1),o(!1),g.o.dismiss();return}let l=t.data,u=t.errors||[];if(u.length>0||!l){g.o.error("Consolidation File could not be parsed."),console.error("CSV Parsing Error (Consolidation):",u),c(!1),o(!1),g.o.dismiss();return}let x=new Map(l.map(e=>[e.Name.trim(),e]));console.log("Students Map:",x);let h={};for(let e of r){let t=await m(e),s=(0,y.E3)(t,{header:!0,skipEmptyLines:!0,transformHeader:e=>e.trim()});if(!(null==s?void 0:s.data)||0===s.data.length){g.o.error("Error parsing attendance log: ".concat(e.name)),console.error("CSV Parsing Error (Attendance Log):",s),c(!1),o(!1),g.o.dismiss();return}let r=s.data,l=s.errors||[];if(l.length>0||!r){g.o.error("Error parsing attendance log: ".concat(e.name)),console.error("CSV Parsing Error (Attendance Log):",l),c(!1),o(!1),g.o.dismiss();return}console.log("Attendance Header:",Object.keys(r[0]||{})),r.forEach(e=>{let t=e.timeIn?new Date(e.timeIn).toLocaleDateString():"Unknown";if(t&&e.Name){h[t]||(h[t]=[]);let s=x.get(e.Name.trim());s?h[t].push((0,n._)((0,a._)({},e),{"User ID":s["User ID"],Section:s.Section,timeIn:d(e.timeIn)||null,timeOut:d(e.timeOut)||null})):console.warn("No matching student found for record: ".concat(e.Name))}})}let f={sections:{},dates:Object.keys(h)};for(let[e,t]of Object.entries(h)){let e={};for(let[s,a]of(t.forEach(t=>{let s=t.Section||"Unknown Section";e[s]||(e[s]={totalStudents:0,students:[],timeInCount:0,timeOutCount:0});let{timeIn:a,timeOut:n}=t;a&&e[s].timeInCount++,n&&e[s].timeOutCount++,e[s].students.push({name:t.Name,timeIn:a,timeOut:n,userID:t["User ID"]}),e[s].totalStudents++}),Object.entries(e)))f.sections[s]?f.sections[s]={totalStudents:f.sections[s].totalStudents+a.totalStudents,students:[...f.sections[s].students,...a.students],timeInCount:f.sections[s].timeInCount+a.timeInCount,timeOutCount:f.sections[s].timeOutCount+a.timeOutCount}:f.sections[s]=a}i(f),g.o.success("Consolidation complete!")}catch(e){console.error("Error during consolidation:",e),g.o.error("Error during consolidation, please check your files.")}finally{c(!1),o(!1),g.o.dismiss()}},[s,r,i,c,o,d]);return(0,l.useImperativeHandle)(t,()=>({consolidateFiles:u})),null});b.displayName="Consolidator";var w=s(31641),C=s(70147),S=s(16099),k=s(11864),I=s(66261),A=s(98435),O=s(58581),_=s(28064),D=s(15255),R=s(12800),E=s(66963),T=s(27112),L=s(86354),V=s(14969);let $=e=>{let{consolidatedData:t}=e,s=(0,l.useMemo)(()=>(null==t?void 0:t.sections)?Object.entries(t.sections).map(e=>{let[t,s]=e;return{section:t,totalStudents:s.totalStudents,timeIn:s.timeInCount,timeOut:s.timeOutCount}}).sort((e,t)=>e.section.localeCompare(t.section)):[],[t]);return(0,r.jsx)(O.u,{width:"100%",height:400,children:(0,r.jsxs)(_.E,{data:s,children:[(0,r.jsx)(D.d,{strokeDasharray:"3 3"}),(0,r.jsx)(R.W,{dataKey:"section"}),(0,r.jsx)(E.h,{}),(0,r.jsx)(T.m,{}),(0,r.jsx)(L.s,{layout:"horizontal",align:"center",verticalAlign:"bottom",wrapperStyle:{paddingTop:10}}),(0,r.jsx)(V.y,{dataKey:"totalStudents",fill:"#808080",name:"Total Students"}),(0,r.jsx)(V.y,{dataKey:"timeIn",fill:"#82ca9d",name:"Time In"}),(0,r.jsx)(V.y,{dataKey:"timeOut",fill:"#8884d8",name:"Time Out"})]})})},F=e=>{var t;let{consolidatedData:s}=e,[a,n]=(0,l.useState)("table"),[i,c]=(0,l.useState)("asc"),[d,m]=(0,l.useState)("section"),u=(0,l.useMemo)(()=>(e,t,s)=>[...e].sort((e,a)=>{let[n,r]=e,[l,i]=a;if("section"===t){let e=e=>{let t=e.match(/^(\d+)([A-Z])$/);return t?[parseInt(t[1],10),t[2]]:[1/0,""]},[t,a]=e(n),[r,i]=e(l);return t!==r?"asc"===s?t-r:r-t:a!==i?"asc"===s?a.localeCompare(i):i.localeCompare(a):0}{let e=r[t]||"",a=i[t]||"";return e<a?"asc"===s?-1:1:e>a?"asc"===s?1:-1:0}}),[]),x=e=>{let t;t=d===e&&"asc"===i?"desc":"asc",m(e),c(t)},h=()=>(null==s?void 0:s.sections)?u(Object.entries(s.sections),d,i):[];return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"flex items-center justify-end",children:(0,r.jsx)(o.$,{variant:"outline",size:"icon",onClick:()=>{n("table"===a?"graph":"table")},children:"table"===a?(0,r.jsx)(C.A,{className:"h-4 w-4"}):(0,r.jsx)(S.A,{className:"h-4 w-4"})})}),"table"===a?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full table-auto text-sm border-collapse",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-4 py-2 text-center",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>x("section"),children:["Section","section"===d?"asc"===i?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"px-4 py-2 text-center",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>x("totalStudents"),children:["Total Students (",(null==s?void 0:s.sections)?Object.values(s.sections).reduce((e,t)=>e+t.totalStudents,0):0,")","totalStudents"===d?"asc"===i?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"px-4 py-2 text-center",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>x("timeInCount"),children:["Time In (",(null==s?void 0:s.sections)?Object.values(s.sections).reduce((e,t)=>e+t.timeInCount,0):0,")","timeInCount"===d?"asc"===i?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"px-4 py-2 text-center",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>x("timeOutCount"),children:["Time Out (",(null==s?void 0:s.sections)?Object.values(s.sections).reduce((e,t)=>e+t.timeOutCount,0):0,")","timeOutCount"===d?"asc"===i?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})})]})}),(0,r.jsx)("tbody",{children:s&&(null===(t=h())||void 0===t?void 0:t.length)>0?h().map(e=>{let[t,s]=e;return(0,r.jsxs)("tr",{className:"gap 1",children:[(0,r.jsx)("td",{className:"px-4 py-2 text-center",children:t}),(0,r.jsx)("td",{className:"px-4 py-2 text-center",children:s.totalStudents}),(0,r.jsx)("td",{className:"px-4 py-2 text-center",children:s.timeInCount}),(0,r.jsx)("td",{className:"px-4 py-2 text-center",children:s.timeOutCount})]},t)}):(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:4,className:"px-4 py-2 text-center text-gray-500",children:"No data to display yet"})})})]})}),(0,r.jsx)("div",{className:"mt-4 flex justify-end space-x-2"})]}):(0,r.jsx)($,{consolidatedData:s})]})};var U=s(56119),z=s(84267),P=s(9955),M=s(94556),H=s(10417),Z=s(29602);let B=H.bL;H.l9;let K=H.ZL;H.bm;let W=l.forwardRef((e,t)=>{var{className:s}=e,n=(0,M._)(e,["className"]);return(0,r.jsx)(H.hJ,(0,a._)({ref:t,className:(0,Z.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s)},n))});W.displayName=H.hJ.displayName;let X=l.forwardRef((e,t)=>{var{className:s,children:l}=e,i=(0,M._)(e,["className","children"]);return(0,r.jsxs)(K,{children:[(0,r.jsx)(W,{}),(0,r.jsxs)(H.UC,(0,n._)((0,a._)({ref:t,className:(0,Z.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s)},i),{children:[l,(0,r.jsxs)(H.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,r.jsx)(j.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"sr-only",children:"Close"})]})]}))]})});X.displayName=H.UC.displayName;let q=e=>{var{className:t}=e,s=(0,M._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({className:(0,Z.cn)("flex flex-col space-y-1.5 text-center sm:text-left",t)},s))};q.displayName="DialogHeader";let J=l.forwardRef((e,t)=>{var{className:s}=e,n=(0,M._)(e,["className"]);return(0,r.jsx)(H.hE,(0,a._)({ref:t,className:(0,Z.cn)("text-lg font-semibold leading-none tracking-tight",s)},n))});J.displayName=H.hE.displayName;let Y=l.forwardRef((e,t)=>{var{className:s}=e,n=(0,M._)(e,["className"]);return(0,r.jsx)(H.VY,(0,a._)({ref:t,className:(0,Z.cn)("text-sm text-muted-foreground",s)},n))});Y.displayName=H.VY.displayName;var Q=s(86352),G=s(98867);let ee=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,M._)(e,["className"]);return(0,r.jsx)(Q.bL,(0,n._)((0,a._)({ref:t,className:(0,Z.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s)},l),{children:(0,r.jsx)(Q.C1,{className:(0,Z.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(G.A,{className:"h-4 w-4"})})}))});ee.displayName=Q.bL.displayName;var et=s(69105);let es=e=>{let{allAttendanceRecords:t,masterlistSections:s}=e,[i,c]=(0,l.useState)("userID"),[d,m]=(0,l.useState)("asc"),[u,x]=(0,l.useState)(""),[h,f]=(0,l.useState)(!1),[p,j]=(0,l.useState)(!1),[g,v]=(0,l.useState)([]),[N,y]=(0,l.useState)(!1),[b,w]=(0,l.useState)(!1),[C,S]=(0,l.useState)(!1),[O,_]=(0,l.useState)({selectedSections:[],filterTimeIn:!1,filterTimeOut:!1,filterDidntAttend:!1}),[D,R]=(0,l.useState)([]);(0,l.useEffect)(()=>{R([...t.map(e=>(0,n._)((0,a._)({},e),{highlightClass:H(e,h),isMissing:L(e)}))].sort((e,t)=>e.userID.localeCompare(t.userID)))},[t,h]);let E=(0,l.useCallback)((e,t,s)=>[...e].sort((e,a)=>{let n=e[t]||"",r=a[t]||"";return n<r?"asc"===s?-1:1:n>r?"asc"===s?1:-1:0}),[]),T=e=>{let t=i===e&&"asc"===d?"desc":"asc";c(e),m(t),R(E(D,e,t))},L=e=>e.timeIn||e.timeOut?e.timeIn?e.timeOut?null:"timeOut":"timeIn":"both",V=(0,l.useCallback)(()=>{let e=[...D];return u&&(e=e.filter(e=>e.name.toLowerCase().includes(u.toLowerCase())||e.section.toLowerCase().includes(u.toLowerCase()))),O.selectedSections.length>0&&(e=e.filter(e=>O.selectedSections.includes(e.section))),O.filterTimeIn&&(e=e.filter(e=>e.timeIn)),O.filterTimeOut&&(e=e.filter(e=>e.timeOut)),O.filterDidntAttend&&(e=e.filter(e=>!e.timeIn&&!e.timeOut)),e},[D,u,O]),$=(0,l.useMemo)(()=>V(),[V]),F=(0,l.useMemo)(()=>$.filter(e=>e.timeIn).length,[$]),M=(0,l.useMemo)(()=>$.filter(e=>e.timeOut).length,[$]),H=(e,t)=>{if(t){if(!e.timeIn&&!e.timeOut)return"bg-gray-200";if(!e.timeIn)return"bg-blue-200";if(!e.timeOut)return"bg-green-200"}return""},K=e=>{v(t=>t.includes(e)?t.filter(t=>t!==e):[...t,e])};return(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsx)(P.p,{type:"text",placeholder:"Search by Name or Section",value:u,onChange:e=>x(e.target.value)}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(et.Kq,{children:(0,r.jsxs)(et.bL,{children:[(0,r.jsx)(et.l9,{asChild:!0,children:(0,r.jsx)(o.$,{variant:"outline",size:"icon",className:(0,Z.cn)(h&&"bg-accent text-accent-foreground"),onClick:()=>f(!h),children:(0,r.jsx)(U.A,{className:"h-4 w-4"})})}),(0,r.jsx)(et.ZL,{children:(0,r.jsx)(et.UC,{side:"bottom",className:"bg-gray-700 text-white p-2 rounded shadow-md",children:(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Highlight Tool"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-green-400 border border-gray-400"}),(0,r.jsx)("span",{children:"Time In Only"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-blue-400 border border-gray-400"}),(0,r.jsx)("span",{children:"Time Out Only"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"w-4 h-4 bg-gray-400 border border-gray-400"}),(0,r.jsx)("span",{children:"Didn't Attend"})]})]})})})]})}),(0,r.jsx)(et.Kq,{children:(0,r.jsxs)(et.bL,{children:[(0,r.jsx)(et.l9,{asChild:!0,children:(0,r.jsx)(o.$,{variant:"outline",size:"icon",className:(0,Z.cn)(O.selectedSections.length>0||N||b||O.filterDidntAttend?"bg-accent text-accent-foreground":""),onClick:()=>{console.log("Filter Button Clicked"),j(!0),v(O.selectedSections),y(O.filterTimeIn),w(O.filterTimeOut),S(O.filterDidntAttend)},children:(0,r.jsx)(z.A,{className:"h-4 w-4"})})}),(0,r.jsx)(et.ZL,{children:(0,r.jsx)(et.UC,{side:"bottom",className:"bg-gray-700 text-white p-2 rounded shadow-md",children:"Apply Filters"})})]})}),(0,r.jsx)(B,{open:p,onOpenChange:j,children:(0,r.jsxs)(X,{className:"max-w-lg",children:[(0,r.jsxs)(q,{children:[(0,r.jsx)(J,{children:"Filter Attendance Records"}),(0,r.jsx)(Y,{children:"Apply filters for better sorting"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-4 mt-4",children:[s&&s.length>0&&(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)("span",{className:"block font-medium",children:"Sections"}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-2 mt-2",children:s.sort().map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(ee,{checked:g.includes(e),onCheckedChange:()=>K(e)}),(0,r.jsx)("span",{children:e})]},e))})]}),(0,r.jsxs)("div",{className:"col-span-1",children:[(0,r.jsx)("span",{className:"block font-medium",children:"Time Status"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,r.jsx)(ee,{checked:N,onCheckedChange:()=>y(!N)}),(0,r.jsx)("span",{children:"Time In"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,r.jsx)(ee,{checked:b,onCheckedChange:()=>w(!b)}),(0,r.jsx)("span",{children:"Time Out"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,r.jsx)(ee,{checked:C,onCheckedChange:()=>S(!C)}),(0,r.jsx)("span",{children:"Didn't Attend"})]})]})]}),(0,r.jsxs)("div",{className:"mt-4 flex justify-end gap-4",children:[(0,r.jsx)(o.$,{variant:"outline",onClick:()=>{_({selectedSections:[],filterTimeIn:!1,filterTimeOut:!1,filterDidntAttend:!1}),v([]),y(!1),w(!1),S(!1)},className:"text-red-500 border-red-500 hover:bg-red-100",children:"Reset Filters"}),(0,r.jsx)(o.$,{variant:"default",onClick:()=>{_({selectedSections:g,filterTimeIn:N,filterTimeOut:b,filterDidntAttend:C}),j(!1)},className:"bg-primary text-primary-foreground shadow hover:bg-primary/90 transition-colors duration-200",children:"Apply Filters"})]})]})})]})]}),(0,r.jsx)("div",{className:"border border-gray-200 rounded-md overflow-hidden",children:(0,r.jsxs)("table",{className:"table-auto w-full text-sm border-collapse",children:[(0,r.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-center py-2 px-3",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>T("userID"),children:["User ID","userID"===i?"asc"===d?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"text-center py-2 px-3",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>T("name"),children:["Name","name"===i?"asc"===d?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"text-center py-2 px-3",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>T("section"),children:["Section","section"===i?"asc"===d?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"text-center py-2 px-3",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>T("timeIn"),children:["Time In (",F,")","timeIn"===i?"asc"===d?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})}),(0,r.jsx)("th",{className:"text-center py-2 px-3",children:(0,r.jsxs)(o.$,{variant:"link",className:"flex items-center justify-center w-full h-full",onClick:()=>T("timeOut"),children:["Time Out (",M,")","timeOut"===i?"asc"===d?(0,r.jsx)(k.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(I.A,{className:"ml-1 h-4 w-4"}):(0,r.jsx)(A.A,{className:"ml-1 h-4 w-4"})]})})]})}),(0,r.jsx)("tbody",{children:0===$.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:5,className:"px-4 py-2 text-center text-gray-500",children:"No data to display yet"})}):$.map(e=>(0,r.jsxs)("tr",{className:e.highlightClass,children:[(0,r.jsx)("td",{className:"text-center py-2 px-3",children:e.userID}),(0,r.jsx)("td",{className:"text-left py-2 px-3",children:e.name}),(0,r.jsx)("td",{className:"text-center py-2 px-3",children:e.section}),(0,r.jsx)("td",{className:"text-center py-2 px-3",children:e.timeIn}),(0,r.jsx)("td",{className:"text-center py-2 px-3",children:e.timeOut})]},e.id))})]})}),(0,r.jsx)("div",{className:"mt-4 flex justify-end space-x-2"})]})},ea=e=>{let{consolidatedData:t,allAttendanceRecords:s,masterlistSections:a}=e,[n,i]=(0,l.useState)("eventOverview");return(0,r.jsxs)(w.tU,{defaultValue:"eventOverview",value:n,onValueChange:i,children:[(0,r.jsxs)(w.j7,{className:"w-full flex justify-center",children:[(0,r.jsx)(w.Xi,{value:"eventOverview",children:"Event Overview"}),(0,r.jsx)(w.Xi,{value:"studentList",children:"Student List"})]}),(0,r.jsx)(w.av,{value:"eventOverview",children:(0,r.jsx)(F,{consolidatedData:t})}),(0,r.jsx)(w.av,{value:"studentList",children:(0,r.jsx)(es,{allAttendanceRecords:s,masterlistSections:a})})]})};var en=s(9133);function er(){let e=(0,en.VP)(),t=(0,i.useRouter)();(0,l.useEffect)(()=>{"unauthenticated"===e&&(g.o.error("Session expired. Please login again."),t.push("/admin"))},[e,t]);let[s,a]=(0,l.useState)(""),[n,f]=(0,l.useState)(null),[p,j]=(0,l.useState)([]),[y,w]=(0,l.useState)(null),[C,S]=(0,l.useState)([]),[k,I]=(0,l.useState)(!1),[A,O]=(0,l.useState)(!1),[_,D]=(0,l.useState)(null),[R,E]=(0,l.useState)(""),[T,L]=(0,l.useState)({}),[V,$]=(0,l.useState)("asc"),[F,U]=(0,l.useState)("section"),[z,M]=(0,l.useState)(!0),H=(0,l.useRef)(null),[Z,K]=(0,l.useState)(!1),W=(0,l.useCallback)(e=>{console.log("handleConsolidatedData: Received data:",e),S([]),w(e),e&&S(Object.values(e.sections).flatMap(t=>t.students.map(s=>({id:crypto.randomUUID(),userID:s.userID,name:s.name,section:Object.keys(e.sections).find(s=>e.sections[s]===t)||"",timeIn:s.timeIn,timeOut:s.timeOut}))))},[]),Q=async()=>{if(y){K(!0),g.o.loading("Preparing CSV File...",{id:"downloading-csv"});try{let e=[["User ID","Name","Section","Time In","Time Out"],...Object.entries(y.sections).flatMap(e=>{let[,t]=e;return t.students.sort((e,t)=>{let s=parseInt(e.userID||"0",10),a=parseInt(t.userID||"0",10);return s-a}).map(e=>[e.userID||"",e.name,Object.keys(y.sections).find(t=>y.sections[t].students.includes(e))||"",e.timeIn||"",e.timeOut||""])})].map(e=>e.join(",")).join("\n"),t=new Blob([e],{type:"text/csv"}),a=window.URL.createObjectURL(t),n=document.createElement("a");n.href=a;let r=s?"".concat(s.replace(/[^a-zA-Z0-9]/g,"_"),"_summary.csv"):"consolidated_attendance_".concat(new Date().toISOString().split("T")[0],".csv");n.download=r,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(a),g.o.success("CSV Downloaded Successfully",{id:"downloading-csv"})}catch(e){g.o.error("Error downloading CSV",{id:"downloading-csv"})}finally{K(!1)}}},G=(0,l.useCallback)(()=>{console.log("Button clicked"),H.current&&(I(!0),H.current.consolidateFiles())},[]),ee=(0,l.useMemo)(()=>(null==y?void 0:y.sections)?Object.keys(null==y?void 0:y.sections):[],[y]),et=e=>{a(e),M(!1)};return(0,r.jsxs)("div",{className:"container mx-auto p-4 h-screen flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"Consolidated Log"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(o.$,{variant:"outline",size:"icon",onClick:()=>t.push("/admin/dashboard"),children:(0,r.jsx)(d.A,{className:"h-4 w-4"})}),(0,r.jsx)(o.$,{variant:"outline",size:"icon",onClick:()=>t.push("/onboarding/administrator"),children:(0,r.jsx)(m.A,{className:"h-4 w-4"})})]})]}),(0,r.jsxs)("div",{className:"flex gap-4 flex-1 overflow-hidden",children:[(0,r.jsxs)("div",{className:"w-1/4 space-y-4 flex flex-col",children:[(0,r.jsxs)(c.Zp,{className:"h-[150px]",children:[(0,r.jsx)(c.aR,{children:(0,r.jsx)(c.ZB,{children:"Consolidation File"})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)(v,{file:n,onFileSelected:e=>{f(e)},onRemove:()=>{f(null)}})})]}),(0,r.jsxs)(c.Zp,{className:"flex-1 overflow-y-auto",children:[(0,r.jsx)(c.aR,{children:(0,r.jsx)(c.ZB,{children:"Attendance Logs"})}),(0,r.jsx)(c.Wu,{children:(0,r.jsx)(N,{files:p,onFilesSelected:e=>{j(t=>[...t,...e])},onRemove:e=>{j(t=>t.filter((t,s)=>s!==e))}})})]}),(0,r.jsx)(o.$,{className:"w-full mt-4",disabled:!n||!p.length||k,onClick:G,children:k?(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(u.A,{className:"h-4 w-4 animate-spin"}),"Consolidating..."]}):"Consolidate Files"}),(0,r.jsx)(b,{consolidationFile:n,attendanceFiles:p,onConsolidated:W,setIsConsolidating:I,setIsParsing:e=>console.log("Parsing: ",e),ref:H})]}),(0,r.jsx)("div",{className:"w-3/4",children:(0,r.jsxs)(c.Zp,{className:"h-full overflow-auto",children:[(0,r.jsx)(c.aR,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold",children:s||"Event Name"}),(0,r.jsx)(o.$,{variant:"ghost",size:"icon",onClick:()=>{M(!0)},children:(0,r.jsx)(x.A,{className:"h-4 w-4"})})]}),y&&(0,r.jsx)(o.$,{variant:"outline",size:"icon",onClick:Q,disabled:Z,children:Z?(0,r.jsx)(u.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(h.A,{})})]})}),(0,r.jsx)(c.Wu,{className:"h-full flex-1 overflow-auto summary-panel",children:(0,r.jsx)("div",{className:"relative w-full h-full ",children:(0,r.jsx)(ea,{consolidatedData:y,allAttendanceRecords:C,masterlistSections:ee})})})]})})]}),(0,r.jsx)(B,{open:z,onOpenChange:M,children:(0,r.jsxs)(X,{children:[(0,r.jsxs)(q,{children:[(0,r.jsx)(J,{children:"Enter Event Name"}),(0,r.jsx)(Y,{children:"Please provide a name for this event."})]}),(0,r.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,r.jsx)("div",{className:"grid gap-2",children:(0,r.jsx)(P.p,{type:"text",placeholder:"Enter event name",className:"text-lg",onKeyDown:e=>{"Enter"===e.key&&et(e.currentTarget.value)}})}),(0,r.jsx)("div",{className:"mt-4 flex justify-end",children:(0,r.jsx)(o.$,{variant:"outline",onClick:()=>{var e;return et((null===(e=document.querySelector("input"))||void 0===e?void 0:e.value)||"")},children:"Apply"})})]})]})})]})}},14085:(e,t,s)=>{"use strict";s.d(t,{$:()=>m,r:()=>d});var a=s(39233),n=s(94556),r=s(95155),l=s(12115),i=s(12317),c=s(31027),o=s(29602);let d=(0,c.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),m=l.forwardRef((e,t)=>{var{className:s,variant:l,size:c,asChild:m=!1}=e,u=(0,n._)(e,["className","variant","size","asChild"]);let x=m?i.DX:"button";return(0,r.jsx)(x,(0,a._)({className:(0,o.cn)(d({variant:l,size:c,className:s})),ref:t},u))});m.displayName="Button"},35007:(e,t,s)=>{"use strict";s.d(t,{Wu:()=>m,ZB:()=>d,Zp:()=>c,aR:()=>o});var a=s(39233),n=s(94556),r=s(95155),l=s(12115),i=s(29602);let c=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("rounded-xl border bg-card text-card-foreground shadow",s)},l))});c.displayName="Card";let o=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",s)},l))});o.displayName="CardHeader";let d=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("font-semibold leading-none tracking-tight",s)},l))});d.displayName="CardTitle",l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("text-sm text-muted-foreground",s)},l))}).displayName="CardDescription";let m=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("p-6 pt-0",s)},l))});m.displayName="CardContent",l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)("div",(0,a._)({ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",s)},l))}).displayName="CardFooter"},9955:(e,t,s)=>{"use strict";s.d(t,{p:()=>c});var a=s(39233),n=s(94556),r=s(95155),l=s(12115),i=s(29602);let c=l.forwardRef((e,t)=>{var{className:s,type:l}=e,c=(0,n._)(e,["className","type"]);return(0,r.jsx)("input",(0,a._)({type:l,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",s),ref:t},c))});c.displayName="Input"},31641:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>m,av:()=>u,j7:()=>d,tU:()=>o});var a=s(39233),n=s(94556),r=s(95155),l=s(12115),i=s(22596),c=s(29602);let o=i.bL,d=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)(i.B8,(0,a._)({ref:t,className:(0,c.cn)("inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground",s)},l))});d.displayName=i.B8.displayName;let m=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)(i.l9,(0,a._)({ref:t,className:(0,c.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow",s)},l))});m.displayName=i.l9.displayName;let u=l.forwardRef((e,t)=>{var{className:s}=e,l=(0,n._)(e,["className"]);return(0,r.jsx)(i.UC,(0,a._)({ref:t,className:(0,c.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s)},l))});u.displayName=i.UC.displayName},29602:(e,t,s)=>{"use strict";s.d(t,{cn:()=>r});var a=s(43463),n=s(69795);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.QP)((0,a.$)(t))}},9133:(e,t,s)=>{"use strict";s.d(t,{VP:()=>n,ln:()=>r});var a=s(12115);function n(){let[e,t]=(0,a.useState)("pending");return(0,a.useEffect)(()=>{"admin"===sessionStorage.getItem("userRole")?t("authenticated"):t("unauthenticated")},[]),e}function r(){sessionStorage.removeItem("userRole"),sessionStorage.removeItem("userName")}}},e=>{var t=t=>e(e.s=t);e.O(0,[524,814,417,725,339,441,517,358],()=>t(55621)),_N_E=e.O()}]);